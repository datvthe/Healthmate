<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tracker & Analyst - Web Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f6f8f6;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #13ec5b;
            margin-bottom: 10px;
        }
        .status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin: 5px;
            display: inline-block;
        }
        .success { background: #10b981; color: white; }
        .error { background: #ef4444; color: white; }
        .pending { background: #f59e0b; color: white; }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }
        .test-button {
            background: #13ec5b;
            color: #0f172a;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            opacity: 0.9;
        }
        .result-box {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .input-group {
            margin: 10px 0;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-group input, .input-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: linear-gradient(135deg, #13ec5b 0%, #10b981 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèãÔ∏è Tracker & Analyst Module</h1>
        <p>Ki·ªÉm tra tr·ª±c ti·∫øp ch·ª©c nƒÉng theo d√µi v√† th·ªëng k√™</p>
        <div id="connection-status">
            <span class="status pending">ƒêang ki·ªÉm tra k·∫øt n·ªëi...</span>
        </div>
    </div>

    <!-- 1. Authentication Section -->
    <div class="container">
        <h2>üîê 1. Authentication</h2>
        <div class="test-section">
            <div class="input-group">
                <label>Email:</label>
                <input type="email" id="email" value="test@example.com" placeholder="Nh·∫≠p email">
            </div>
            <div class="input-group">
                <label>Password:</label>
                <input type="password" id="password" value="password123" placeholder="Nh·∫≠p password">
            </div>
            <button class="test-button" onclick="testLogin()">üîë Login</button>
            <button class="test-button" onclick="testRegister()">üìù Register</button>
            <div id="auth-result" class="result-box"></div>
        </div>
    </div>

    <!-- 2. Dashboard Stats -->
    <div class="container">
        <h2>üìä 2. Dashboard Statistics</h2>
        <div class="test-section">
            <button class="test-button" onclick="testDashboardStats()">üìà L·∫•y Dashboard Stats</button>
            <div id="dashboard-result" class="result-box"></div>
            <div id="stats-display" class="stats-grid"></div>
        </div>
    </div>

    <!-- 3. Workout Logs -->
    <div class="container">
        <h2>üí™ 3. Workout Logs</h2>
        <div class="test-section">
            <h3>Th√™m Workout Log:</h3>
            <div class="input-group">
                <label>Workout ID (demo):</label>
                <input type="text" id="workout_id" value="64f1a2b3c4d5e6f7g8h9i0j1" placeholder="Workout ID">
            </div>
            <div class="input-group">
                <label>Th·ªùi gian (ph√∫t):</label>
                <input type="number" id="duration" value="45" placeholder="Duration">
            </div>
            <div class="input-group">
                <label>Calories ƒë·ªët:</label>
                <input type="number" id="calories" value="350" placeholder="Calories">
            </div>
            <div class="input-group">
                <label>Ghi ch√∫:</label>
                <textarea id="notes" placeholder="Notes v·ªÅ bu·ªïi t·∫≠p">T·∫≠p r·∫•t t·ªët h√¥m nay!</textarea>
            </div>
            <button class="test-button" onclick="saveWorkoutLog()">üíæ L∆∞u Workout Log</button>
            <button class="test-button" onclick="getWorkoutLogs()">üìã L·∫•y Workout Logs</button>
            <div id="workout-result" class="result-box"></div>
        </div>
    </div>

    <!-- 4. Body Progress -->
    <div class="container">
        <h2>‚öñÔ∏è 4. Body Progress</h2>
        <div class="test-section">
            <h3>C·∫≠p nh·∫≠t c√¢n n·∫∑ng:</h3>
            <div class="input-group">
                <label>C√¢n n·∫∑ng (kg):</label>
                <input type="number" id="weight" value="75.5" step="0.1" placeholder="Weight">
            </div>
            <div class="input-group">
                <label>T·ª∑ l·ªá m·ª° (%):</label>
                <input type="number" id="body_fat" value="18.5" step="0.1" placeholder="Body Fat %">
            </div>
            <div class="input-group">
                <label>Ghi ch√∫:</label>
                <textarea id="weight_notes" placeholder="Notes v·ªÅ c√¢n n·∫∑ng">Gi·∫£m 0.5kg so v·ªõi tu·∫ßn tr∆∞·ªõc</textarea>
            </div>
            <button class="test-button" onclick="updateBodyProgress()">‚öñÔ∏è C·∫≠p nh·∫≠t Weight</button>
            <button class="test-button" onclick="getBodyProgress()">üìà L·∫•y Progress Data</button>
            <div id="body-result" class="result-box"></div>
        </div>
    </div>

    <!-- 5. Quick Test Data -->
    <div class="container">
        <h2>üöÄ 5. Quick Test Data</h2>
        <div class="test-section">
            <p>T·ª± ƒë·ªông t·∫°o d·ªØ li·ªáu m·∫´u ƒë·ªÉ test:</p>
            <button class="test-button" onclick="createSampleData()">üé≤ T·∫°o Sample Data</button>
            <button class="test-button" onclick="clearAllData()">üóëÔ∏è X√≥a All Data</button>
            <div id="sample-result" class="result-box"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api';
        let authToken = localStorage.getItem('test_token') || '';

        // Update connection status
        async function checkConnection() {
            try {
                const response = await fetch(`${API_BASE}/users/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: 'test@test.com', password: 'test' })
                });
                
                const statusDiv = document.getElementById('connection-status');
                if (response.status === 401 || response.status === 400) {
                    statusDiv.innerHTML = '<span class="status success">‚úÖ Backend ƒëang ch·∫°y (port 8000)</span>';
                } else {
                    statusDiv.innerHTML = '<span class="status success">‚úÖ K·∫øt n·ªëi th√†nh c√¥ng</span>';
                }
            } catch (error) {
                document.getElementById('connection-status').innerHTML = 
                    '<span class="status error">‚ùå Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c ƒë·∫øn backend. H√£y ch·∫Øc ch·∫Øn server ƒëang ch·∫°y port 8000</span>';
            }
        }

        function showResult(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="${isError ? 'error' : 'success'}">${message}</div>`;
        }

        function showJSON(elementId, data) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

        // 1. Authentication
        async function testLogin() {
            try {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                const response = await fetch(`${API_BASE}/users/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.token;
                    localStorage.setItem('test_token', authToken);
                    showResult('auth-result', `‚úÖ Login th√†nh c√¥ng! Token: ${authToken.substring(0, 20)}...`);
                } else {
                    showResult('auth-result', `‚ùå Login th·∫•t b·∫°i: ${data.message}`, true);
                }
                
                showJSON('auth-result', data);
            } catch (error) {
                showResult('auth-result', `‚ùå Error: ${error.message}`, true);
            }
        }

        async function testRegister() {
            try {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                const response = await fetch(`${API_BASE}/users/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        email, 
                        password,
                        name: 'Test User',
                        age: 25,
                        gender: 'male',
                        height: 175,
                        weight: 75,
                        goal: 'gain_muscle'
                    })
                });
                
                const data = await response.json();
                showJSON('auth-result', data);
                
                if (response.ok) {
                    showResult('auth-result', '‚úÖ Register th√†nh c√¥ng! H√£y login ƒë·ªÉ l·∫•y token.');
                } else {
                    showResult('auth-result', `‚ùå Register th·∫•t b·∫°i: ${data.message}`, true);
                }
            } catch (error) {
                showResult('auth-result', `‚ùå Error: ${error.message}`, true);
            }
        }

        // 2. Dashboard Stats
        async function testDashboardStats() {
            try {
                const response = await fetch(`${API_BASE}/tracker/dashboard-stats`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                const data = await response.json();
                showJSON('dashboard-result', data);
                
                if (response.ok) {
                    // Display stats cards
                    const statsHTML = `
                        <div class="stat-card">
                            <div class="stat-number">${data.week.totalCalories || 0}</div>
                            <div class="stat-label">Calories/Tu·∫ßn</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${data.week.totalWorkouts || 0}</div>
                            <div class="stat-label">Workouts/Tu·∫ßn</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${data.body.currentWeight || '--'}</div>
                            <div class="stat-label">Weight (kg)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${data.week.totalDuration || 0}</div>
                            <div class="stat-label">Duration (ph√∫t)</div>
                        </div>
                    `;
                    document.getElementById('stats-display').innerHTML = statsHTML;
                    showResult('dashboard-result', '‚úÖ Dashboard stats loaded successfully!');
                } else {
                    showResult('dashboard-result', `‚ùå Error: ${data.message}`, true);
                }
            } catch (error) {
                showResult('dashboard-result', `‚ùå Error: ${error.message}`, true);
            }
        }

        // 3. Workout Logs
        async function saveWorkoutLog() {
            try {
                const workout_id = document.getElementById('workout_id').value;
                const duration = document.getElementById('duration').value;
                const calories = document.getElementById('calories').value;
                const notes = document.getElementById('notes').value;
                
                const response = await fetch(`${API_BASE}/tracker/workouts`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ workout_id, duration_minutes: parseInt(duration), calories_burned: parseInt(calories), notes })
                });
                
                const data = await response.json();
                showJSON('workout-result', data);
                
                if (response.ok) {
                    showResult('workout-result', '‚úÖ Workout log saved successfully!');
                } else {
                    showResult('workout-result', `‚ùå Error: ${data.message}`, true);
                }
            } catch (error) {
                showResult('workout-result', `‚ùå Error: ${error.message}`, true);
            }
        }

        async function getWorkoutLogs() {
            try {
                const response = await fetch(`${API_BASE}/tracker/workouts?period=week&limit=10`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                const data = await response.json();
                showJSON('workout-result', data);
                
                if (response.ok) {
                    showResult('workout-result', `‚úÖ Found ${data.workoutLogs.length} workout logs`);
                } else {
                    showResult('workout-result', `‚ùå Error: ${data.message}`, true);
                }
            } catch (error) {
                showResult('workout-result', `‚ùå Error: ${error.message}`, true);
            }
        }

        // 4. Body Progress
        async function updateBodyProgress() {
            try {
                const weight = document.getElementById('weight').value;
                const body_fat = document.getElementById('body_fat').value;
                const notes = document.getElementById('weight_notes').value;
                
                const response = await fetch(`${API_BASE}/tracker/body-progress`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        weight_kg: parseFloat(weight), 
                        body_fat_percentage: parseFloat(body_fat), 
                        note: notes 
                    })
                });
                
                const data = await response.json();
                showJSON('body-result', data);
                
                if (response.ok) {
                    showResult('body-result', '‚úÖ Body progress updated successfully!');
                } else {
                    showResult('body-result', `‚ùå Error: ${data.message}`, true);
                }
            } catch (error) {
                showResult('body-result', `‚ùå Error: ${error.message}`, true);
            }
        }

        async function getBodyProgress() {
            try {
                const response = await fetch(`${API_BASE}/tracker/body-progress?period=month`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                const data = await response.json();
                showJSON('body-result', data);
                
                if (response.ok) {
                    showResult('body-result', `‚úÖ Found ${data.bodyProgress.length} body progress records`);
                } else {
                    showResult('body-result', `‚ùå Error: ${data.message}`, true);
                }
            } catch (error) {
                showResult('body-result', `‚ùå Error: ${error.message}`, true);
            }
        }

        // 5. Sample Data
        async function createSampleData() {
            try {
                showResult('sample-result', 'üîÑ ƒêang t·∫°o sample data...');
                
                // Create body progress data
                const weightData = [
                    { weight_kg: 78, note: "ƒê·∫ßu th√°ng" },
                    { weight_kg: 77.5, note: "Tu·∫ßn 1" },
                    { weight_kg: 76.8, note: "Tu·∫ßn 2" },
                    { weight_kg: 76.2, note: "Tu·∫ßn 3" },
                    { weight_kg: 75.5, note: "Hi·ªán t·∫°i" }
                ];

                for (let i = 0; i < weightData.length; i++) {
                    const date = new Date();
                    date.setDate(date.getDate() - (4 - i) * 7);
                    
                    await fetch(`${API_BASE}/tracker/body-progress`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            weight_kg: weightData[i].weight_kg,
                            note: weightData[i].note
                        })
                    });
                }

                // Create workout logs
                const workouts = [
                    { name: "Push Day", calories: 300, duration: 45 },
                    { name: "Pull Day", calories: 280, duration: 40 },
                    { name: "Leg Day", calories: 350, duration: 50 },
                    { name: "Cardio", calories: 200, duration: 30 },
                    { name: "HIIT", calories: 400, duration: 35 }
                ];

                for (let i = 0; i < workouts.length; i++) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    
                    await fetch(`${API_BASE}/tracker/workouts`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            workout_id: "64f1a2b3c4d5e6f7g8h9i0j1",
                            duration_minutes: workouts[i].duration,
                            calories_burned: workouts[i].calories,
                            notes: `${workouts[i].name} - ${i === 0 ? 'H√¥m nay' : `${i} ng√†y tr∆∞·ªõc`}`
                        })
                    });
                }

                showResult('sample-result', '‚úÖ Sample data created successfully! Refresh dashboard to see changes.');
                
                // Auto-refresh dashboard stats
                setTimeout(() => testDashboardStats(), 1000);
                
            } catch (error) {
                showResult('sample-result', `‚ùå Error: ${error.message}`, true);
            }
        }

        async function clearAllData() {
            if (!confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ data?')) return;
            
            try {
                showResult('sample-result', 'üîÑ ƒêang x√≥a data...');
                
                // This would require delete endpoints - for now just show message
                showResult('sample-result', '‚ÑπÔ∏è Ch·ª©c nƒÉng x√≥a data c·∫ßn th√™m DELETE endpoints v√†o backend');
                
            } catch (error) {
                showResult('sample-result', `‚ùå Error: ${error.message}`, true);
            }
        }

        // Initialize
        window.onload = function() {
            checkConnection();
            
            // Auto-fill token if exists
            if (authToken) {
                showResult('auth-result', `‚úÖ Token s·∫µn c√≥: ${authToken.substring(0, 20)}...`);
            }
        };
    </script>
</body>
</html>
